/* 
* Webkitresize (http://editorboost.net/webkitresize)
* Copyright 2012 Editorboost. All rights reserved. 
*
* Webkitresize commercial licenses may be obtained at http://editorboost.net/home/licenses.
* If you do not own a commercial license, this file shall be governed by the
* GNU General Public License (GPL) version 3. For GPL requirements, please
* review: http://www.gnu.org/copyleft/gpl.html
*
* Version date: Dec 01 2012
* REQUIRES: jquery 1.7.1+
*/
; (function (e) { e.fn.webkitimageresize = function (t) { return this.each(function () { if (!e.browser.webkit) { return } var n = e.extend({}, t); var r; var s = false; var o; var u; var a; var f; var l; var c = { removeResizeElements: function (t) { e(".img-resize-selector").remove(); e(".img-resize-region").remove() }, imageClick: function (t, r) { if (n.beforeElementSelect) { n.beforeElementSelect(r) } c.removeResizeElements(); o = r; var i = e(r).outerHeight(); var h = e(r).outerWidth(); var p = t.$ifrm.offset(); var d = e(r).offset(); var v = t.$ifrmBody.scrollTop(); var m = t.$ifrmBody.scrollLeft(); t.$docBody.append("<span class='img-resize-selector' style='margin:10px;position:absolute;top:" + (p.top + d.top - v + i - 10) + "px;left:" + (p.left + d.left - m + h - 10) + "px;border:solid 2px red;width:6px;height:6px;cursor:se-resize;z-index:1;'></span>"); t.$docBody.append("<span class='img-resize-region region-top-right' style='position:absolute;top:" + (p.top + d.top - v) + "px;left:" + (p.left + d.left - m) + "px;border:dashed 1px grey;width:" + h + "px;height:0px;'></span>"); t.$docBody.append("<span class='img-resize-region region-top-down' style='position:absolute;top:" + (p.top + d.top - v) + "px;left:" + (p.left + d.left - m) + "px;border:dashed 1px grey;width:0px;height:" + i + "px;'></span>"); t.$docBody.append("<span class='img-resize-region region-right-down' style='position:absolute;top:" + (p.top + d.top - v) + "px;left:" + (p.left + d.left - m + h) + "px;border:dashed 1px grey;width:0px;height:" + i + "px;'></span>"); t.$docBody.append("<span class='img-resize-region region-down-left' style='position:absolute;top:" + (p.top + d.top - v + i) + "px;left:" + (p.left + d.left - m) + "px;border:dashed 1px grey;width:" + h + "px;height:0px;'></span>"); var g = function () { if (s) { e(o).css("width", e(".region-top-right").width() + "px").css("height", e(".region-top-down").height() + "px"); c.refresh(t); e(o).click(); e(document).trigger("webkitresize-updatecrc", [c.crc(t.$ifrmBody.html()), t.ifrm]); s = false; if (n.afterResize) { n.afterResize(o) } } }; var y = function (t) { if (s) { var r = h; var o = i; o = t.pageY - d.top; r = t.pageX - d.left; if (o < 1) { o = 1 } if (r < 1) { r = 1 } if (n.keepAspectRatio || t.ctrlKey) { var c = f - o; if (c < 0) { c = c * -1 } var g = l - r; if (g < 0) { g = g * -1 } if (c > g) { r = o * a } else { o = r * u } } e(".img-resize-selector").css("top", p.top + d.top - v + o - 10 + "px").css("left", p.left + d.left - m + r - 10 + "px"); e(".region-top-right").css("width", r + "px"); e(".region-top-down").css("height", o + "px"); e(".region-right-down").css("left", p.left + d.left - m + r + "px").css("height", o + "px"); e(".region-down-left").css("top", p.top + d.top - v + o + "px").css("width", r + "px") } return false }; var b = function (t) { if (s) { var r = h; var o = i; o = t.pageY - (p.top + d.top - v); r = t.pageX - (p.left + d.left - m); if (o < 1) { o = 1 } if (r < 1) { r = 1 } if (n.keepAspectRatio || t.ctrlKey) { var c = f - o; if (c < 0) { c = c * -1 } var g = l - r; if (g < 0) { g = g * -1 } if (c > g) { r = o * a } else { o = r * u } } e(".img-resize-selector").css("top", p.top + d.top - v + o - 10 + "px").css("left", p.left + d.left - m + r - 10 + "px"); e(".region-top-right").css("width", r + "px"); e(".region-top-down").css("height", o + "px"); e(".region-right-down").css("left", p.left + d.left - m + r + "px").css("height", o + "px"); e(".region-down-left").css("top", p.top + d.top - v + o + "px").css("width", r + "px") } return false }; e(".img-resize-selector").mousedown(function (t) { if (n.beforeResizeStart) { n.beforeResizeStart(o) } var r = e(o).height(); var i = e(o).width(); u = r / i; a = i / r; if (r > i) { f = 0; l = (r - i) * -1 } else { l = 0; f = (i - r) * -1 } s = true; return false }); e(t.ifrm.contentWindow.document).mouseup(function () { if (s) { g() } }); e(window.document).mouseup(function () { if (s) { g() } }); e(t.ifrm.contentWindow.document).mousemove(function (e) { y(e) }); e(window.document).mousemove(function (e) { b(e) }); if (n.afterElementSelect) { n.afterElementSelect(o) } }, rebind: function (t) { t.$ifrm.contents().find("img").each(function (n, r) { e(r).unbind("click"); e(r).click(function (e) { if (e.target == r) { c.imageClick(t, r) } }) }) }, refresh: function (t) { c.rebind(t); c.removeResizeElements(); if (!o) { if (n.afterRefresh) { n.afterRefresh(null) } return } var i = o; var s = e(i).outerHeight(); var u = e(i).outerWidth(); var a = t.$ifrm.offset(); var f = e(i).offset(); var l = t.$ifrmBody.scrollTop(); var h = t.$ifrmBody.scrollLeft(); t.$docBody.append("<span class='img-resize-selector' style='position:absolute;top:" + (a.top + f.top - l + s) + "px;left:" + (a.left + f.left - h + u) + "px;border:solid 2px red;width:6px;height:6px;cursor:se-resize;z-index:1;'></span>"); t.$docBody.append("<span class='img-resize-region' style='position:absolute;top:" + (a.top + f.top - l) + "px;left:" + (a.left + f.left - h) + "px;border:dashed 1px grey;width:" + u + "px;height:0px;'></span>"); t.$docBody.append("<span class='img-resize-region' style='position:absolute;top:" + (a.top + f.top - l) + "px;left:" + (a.left + f.left - h) + "px;border:dashed 1px grey;width:0px;height:" + s + "px;'></span>"); t.$docBody.append("<span class='img-resize-region' style='position:absolute;top:" + (a.top + f.top - l) + "px;left:" + (a.left + f.left - h + u) + "px;border:dashed 1px grey;width:0px;height:" + s + "px;'></span>"); t.$docBody.append("<span class='img-resize-region' style='position:absolute;top:" + (a.top + f.top - l + s) + "px;left:" + (a.left + f.left - h) + "px;border:dashed 1px grey;width:" + u + "px;height:0px;'></span>"); r = c.crc(t.$ifrmBody.html()); if (n.afterRefresh) { n.afterRefresh(o) } }, reset: function (e) { if (o != null) { o = null; s = false; c.removeResizeElements(); if (n.afterReset) { n.afterReset() } } c.rebind(e) }, crc: function (e) { var t = 0; if (e.length == 0) return t; for (i = 0; i < e.length; i++) { char = e.charCodeAt(i); t = (t << 5) - t + char; t = t & t } return t } }; var h = this; var p = e(this); var d = e("body"); var v = p.contents().find("body"); r = c.crc(v.html()); if (!p.is("iframe")) { return } var m = { ifrm: h, $ifrm: p, $docBody: d, $ifrmBody: v }; h.contentWindow.addEventListener("scroll", function () { c.reset(m) }, false); e(h.contentWindow.document).mouseup(function (t) { if (!s) { if (r != c.crc(v.html())) { c.reset(m) } else { var n = t.x ? t.x : t.clientX; var i = t.y ? t.y : t.clientY; var o = h.contentWindow.document.elementFromPoint(n, i); if (o) { if (!e(o).is("img")) { c.reset(m) } } else { c.reset(m) } } } }); e(document).keyup(function (e) { if (e.keyCode == 27) { c.reset(m) } }); e(h.contentWindow.document).keyup(function (e) { if (e.keyCode == 27) { c.reset(m) } }); if (!h.crcChecker) { h.crcChecker = setInterval(function () { var t = c.crc(v.html()); if (r != t) { e(document).trigger("webkitresize-crcchanged", [t, h]) } }, 1e3) } e(window).resize(function () { c.reset(m) }); e(document).bind("webkitresize-crcchanged", function (e, t, n) { if (h != n) return; r = t; c.reset(m) }); e(document).bind("webkitresize-updatecrc", function (e, t, n) { if (h != n) return; r = t }); c.refresh(m) }) }; e.fn.webkittableresize = function (t) { return this.each(function () { if (!e.browser.webkit) { return } var n = e.extend({}, t); var r; var s = false; var o; var u = { removeResizeElements: function (t) { e(".resize-selector").remove(); e(".resize-region").remove() }, tableClick: function (t, r) { if (n.beforeElementSelect) { n.beforeElementSelect(r) } u.removeResizeElements(); o = r; var i = e(r).outerHeight(); var a = e(r).outerWidth(); var f = t.$ifrm.offset(); var l = e(r).offset(); var c = t.$ifrmBody.scrollTop(); var h = t.$ifrmBody.scrollLeft(); t.$docBody.append("<span class='resize-selector' style='margin:10px;position:absolute;top:" + (f.top + l.top - c + i - 10) + "px;left:" + (f.left + l.left - h + a - 10) + "px;border:solid 2px red;width:6px;height:6px;cursor:se-resize;z-index:1;'></span>"); t.$docBody.append("<span class='resize-region region-top-right' style='position:absolute;top:" + (f.top + l.top - c) + "px;left:" + (f.left + l.left - h) + "px;border:dashed 1px grey;width:" + a + "px;height:0px;'></span>"); t.$docBody.append("<span class='resize-region region-top-down' style='position:absolute;top:" + (f.top + l.top - c) + "px;left:" + (f.left + l.left - h) + "px;border:dashed 1px grey;width:0px;height:" + i + "px;'></span>"); t.$docBody.append("<span class='resize-region region-right-down' style='position:absolute;top:" + (f.top + l.top - c) + "px;left:" + (f.left + l.left - h + a) + "px;border:dashed 1px grey;width:0px;height:" + i + "px;'></span>"); t.$docBody.append("<span class='resize-region region-down-left' style='position:absolute;top:" + (f.top + l.top - c + i) + "px;left:" + (f.left + l.left - h) + "px;border:dashed 1px grey;width:" + a + "px;height:0px;'></span>"); var p = function () { if (s) { e(o).css("width", e(".region-top-right").width() + "px").css("height", e(".region-top-down").height() + "px"); u.refresh(t); e(o).click(); e(document).trigger("webkitresize-updatecrc", [u.crc(t.$ifrmBody.html()), t.ifrm]); e(document).trigger("webkitresize-table-resized", [t.ifrm]); s = false; if (n.afterResize) { n.afterResize(o) } } }; var d = function (t) { if (s) { var n = a; var r = i; r = t.pageY - l.top; n = t.pageX - l.left; if (r < 1) { r = 1 } if (n < 1) { n = 1 } e(".resize-selector").css("top", f.top + l.top - c + r - 10 + "px").css("left", f.left + l.left - h + n - 10 + "px"); e(".region-top-right").css("width", n + "px"); e(".region-top-down").css("height", r + "px"); e(".region-right-down").css("left", f.left + l.left - h + n + "px").css("height", r + "px"); e(".region-down-left").css("top", f.top + l.top - c + r + "px").css("width", n + "px") } return false }; var v = function (t) { if (s) { var n = a; var r = i; r = t.pageY - (f.top + l.top - c); n = t.pageX - (f.left + l.left - h); if (r < 1) { r = 1 } if (n < 1) { n = 1 } e(".resize-selector").css("top", f.top + l.top - c + r - 10 + "px").css("left", f.left + l.left - h + n - 10 + "px"); e(".region-top-right").css("width", n + "px"); e(".region-top-down").css("height", r + "px"); e(".region-right-down").css("left", f.left + l.left - h + n + "px").css("height", r + "px"); e(".region-down-left").css("top", f.top + l.top - c + r + "px").css("width", n + "px") } return false }; e(".resize-selector").mousedown(function (e) { if (n.beforeResizeStart) { n.beforeResizeStart(o) } s = true; return false }); e("*").mouseup(function () { if (s) { p() } }); e(t.ifrm.contentWindow).mousemove(function (e) { d(e) }); e(window).mousemove(function (e) { v(e) }); if (n.afterElementSelect) { n.afterElementSelect(o) } }, rebind: function (t) { t.$ifrm.contents().find("table").each(function (n, r) { e(r).unbind("click"); e(r).click(function (n) { if (n.target == r || e(n.target).is("td") && e(n.target).parents("table")[0] == r) { u.tableClick(t, r) } }) }) }, refresh: function (t) { u.rebind(t); u.removeResizeElements(); if (!o) { if (n.afterRefresh) { n.afterRefresh(null) } return } var i = o; var s = e(i).outerHeight(); var a = e(i).outerWidth(); var f = t.$ifrm.offset(); var l = e(i).offset(); var c = t.$ifrmBody.scrollTop(); var h = t.$ifrmBody.scrollLeft(); t.$docBody.append("<span class='resize-selector' style='position:absolute;top:" + (f.top + l.top - c + s) + "px;left:" + (f.left + l.left - h + a) + "px;border:solid 2px red;width:6px;height:6px;cursor:se-resize;z-index:1;'></span>"); t.$docBody.append("<span class='resize-region' style='position:absolute;top:" + (f.top + l.top - c) + "px;left:" + (f.left + l.left - h) + "px;border:dashed 1px grey;width:" + a + "px;height:0px;'></span>"); t.$docBody.append("<span class='resize-region' style='position:absolute;top:" + (f.top + l.top - c) + "px;left:" + (f.left + l.left - h) + "px;border:dashed 1px grey;width:0px;height:" + s + "px;'></span>"); t.$docBody.append("<span class='resize-region' style='position:absolute;top:" + (f.top + l.top - c) + "px;left:" + (f.left + l.left - h + a) + "px;border:dashed 1px grey;width:0px;height:" + s + "px;'></span>"); t.$docBody.append("<span class='resize-region' style='position:absolute;top:" + (f.top + l.top - c + s) + "px;left:" + (f.left + l.left - h) + "px;border:dashed 1px grey;width:" + a + "px;height:0px;'></span>"); r = u.crc(t.$ifrmBody.html()); if (n.afterRefresh) { n.afterRefresh(o) } }, reset: function (e) { if (o != null) { o = null; s = false; u.removeResizeElements(); if (n.afterReset) { n.afterReset() } } u.rebind(e) }, crc: function (e) { var t = 0; if (e.length == 0) return t; for (i = 0; i < e.length; i++) { char = e.charCodeAt(i); t = (t << 5) - t + char; t = t & t } return t } }; var a = this; var f = e(this); var l = e("body"); var c = f.contents().find("body"); r = u.crc(c.html()); if (!f.is("iframe")) { return } var h = { ifrm: a, $ifrm: f, $docBody: l, $ifrmBody: c }; a.contentWindow.addEventListener("scroll", function () { u.reset(h) }, false); e(a.contentWindow.document).mouseup(function (t) { if (r != u.crc(c.html())) { u.reset(h) } else { var n = t.x ? t.x : t.clientX; var i = t.y ? t.y : t.clientY; var s = a.contentWindow.document.elementFromPoint(n, i); if (s) { if (!e(s).is("table")) { u.reset(h) } } else { u.reset(h) } } }); e(document).keyup(function (e) { if (e.keyCode == 27) { u.reset(h) } }); if (!a.crcChecker) { a.crcChecker = setInterval(function () { var t = u.crc(c.html()); if (r != t) { e(document).trigger("webkitresize-crcchanged", [t, a]) } }, 1e3) } e(window).resize(function () { u.reset(h) }); e(document).bind("webkitresize-crcchanged", function (e, t, n) { if (a != n) return; r = t; u.reset(h) }); e(document).bind("webkitresize-updatecrc", function (e, t, n) { if (a != n) return; r = t }); u.refresh(h) }) }; e.fn.webkittdresize = function (t) { return this.each(function () { if (!e.browser.webkit) { return } var n = e.extend({}, t); var r; var s = false; var o; var u = { removeResizeElements: function (t) { e(".td-resize-selector").remove(); e(".td-resize-region").remove() }, tdClick: function (t, r) { if (n.beforeElementSelect) { n.beforeElementSelect(r) } u.removeResizeElements(); o = r; var i = e(r).outerHeight(); var a = e(r).outerWidth(); var f = t.$ifrm.offset(); var l = e(r).offset(); var c = t.$ifrmBody.scrollTop(); var h = t.$ifrmBody.scrollLeft(); t.$docBody.append("<span class='td-resize-selector' style='margin:10px;position:absolute;top:" + (f.top + l.top - c + i - 10) + "px;left:" + (f.left + l.left - h + a - 10) + "px;border:solid 2px red;width:6px;height:6px;cursor:se-resize;z-index:1;'></span>"); t.$docBody.append("<span class='td-resize-region td-region-top-right' style='position:absolute;top:" + (f.top + l.top - c) + "px;left:" + (f.left + l.left - h) + "px;border:dashed 1px green;width:" + a + "px;height:0px;'></span>"); t.$docBody.append("<span class='td-resize-region td-region-top-down' style='position:absolute;top:" + (f.top + l.top - c) + "px;left:" + (f.left + l.left - h) + "px;border:dashed 1px green;width:0px;height:" + i + "px;'></span>"); t.$docBody.append("<span class='td-resize-region td-region-right-down' style='position:absolute;top:" + (f.top + l.top - c) + "px;left:" + (f.left + l.left - h + a) + "px;border:dashed 1px green;width:0px;height:" + i + "px;'></span>"); t.$docBody.append("<span class='td-resize-region td-region-down-left' style='position:absolute;top:" + (f.top + l.top - c + i) + "px;left:" + (f.left + l.left - h) + "px;border:dashed 1px green;width:" + a + "px;height:0px;'></span>"); var p = function () { if (s) { e(o).css("width", e(".td-region-top-right").width() + "px").css("height", e(".td-region-top-down").height() + "px"); u.refresh(t); e(o).click(); e(document).trigger("webkitresize-updatecrc", [u.crc(t.$ifrmBody.html()), t.ifrm]); s = false; if (n.afterResize) { n.afterResize(o) } } }; var d = function (t) { if (s) { var n = a; var r = i; r = t.pageY - l.top; n = t.pageX - l.left; if (r < 1) { r = 1 } if (n < 1) { n = 1 } e(".td-resize-selector").css("top", f.top + l.top - c + r - 10 + "px").css("left", f.left + l.left - h + n - 10 + "px"); e(".td-region-top-right").css("width", n + "px"); e(".td-region-top-down").css("height", r + "px"); e(".td-region-right-down").css("left", f.left + l.left - h + n + "px").css("height", r + "px"); e(".td-region-down-left").css("top", f.top + l.top - c + r + "px").css("width", n + "px") } return false }; var v = function (t) { if (s) { var n = a; var r = i; r = t.pageY - (f.top + l.top - c); n = t.pageX - (f.left + l.left - h); if (r < 1) { r = 1 } if (n < 1) { n = 1 } e(".td-resize-selector").css("top", f.top + l.top - c + r - 10 + "px").css("left", f.left + l.left - h + n - 10 + "px"); e(".td-region-top-right").css("width", n + "px"); e(".td-region-top-down").css("height", r + "px"); e(".td-region-right-down").css("left", f.left + l.left - h + n + "px").css("height", r + "px"); e(".td-region-down-left").css("top", f.top + l.top - c + r + "px").css("width", n + "px") } return false }; e(".td-resize-selector").mousedown(function (e) { if (n.beforeResizeStart) { n.beforeResizeStart(o) } s = true; return false }); e("*").mouseup(function () { if (s) { p() } }); e(t.ifrm.contentWindow).mousemove(function (e) { d(e) }); e(window).mousemove(function (e) { v(e) }); if (n.afterElementSelect) { n.afterElementSelect(o) } }, rebind: function (t) { t.$ifrm.contents().find("td").each(function (n, r) { e(r).unbind("click"); e(r).click(function (e) { if (e.target == r) { u.tdClick(t, r) } }) }) }, refresh: function (t) { u.rebind(t); u.removeResizeElements(); if (!o) { if (n.afterRefresh) { n.afterRefresh(null) } return } var i = o; var s = e(i).outerHeight(); var a = e(i).outerWidth(); var f = t.$ifrm.offset(); var l = e(i).offset(); var c = t.$ifrmBody.scrollTop(); var h = t.$ifrmBody.scrollLeft(); t.$docBody.append("<span class='td-resize-selector' style='position:absolute;top:" + (f.top + l.top - c + s) + "px;left:" + (f.left + l.left - h + a) + "px;border:solid 2px red;width:6px;height:6px;cursor:se-resize;z-index:1;'></span>"); t.$docBody.append("<span class='td-resize-region' style='position:absolute;top:" + (f.top + l.top - c) + "px;left:" + (f.left + l.left - h) + "px;border:dashed 1px green;width:" + a + "px;height:0px;'></span>"); t.$docBody.append("<span class='td-resize-region' style='position:absolute;top:" + (f.top + l.top - c) + "px;left:" + (f.left + l.left - h) + "px;border:dashed 1px green;width:0px;height:" + s + "px;'></span>"); t.$docBody.append("<span class='td-resize-region' style='position:absolute;top:" + (f.top + l.top - c) + "px;left:" + (f.left + l.left - h + a) + "px;border:dashed 1px green;width:0px;height:" + s + "px;'></span>"); t.$docBody.append("<span class='td-resize-region' style='position:absolute;top:" + (f.top + l.top - c + s) + "px;left:" + (f.left + l.left - h) + "px;border:dashed 1px green;width:" + a + "px;height:0px;'></span>"); r = u.crc(t.$ifrmBody.html()); if (n.afterRefresh) { n.afterRefresh(o) } }, reset: function (e) { if (o != null) { o = null; s = false; u.removeResizeElements(); if (n.afterReset) { n.afterReset() } } u.rebind(e) }, crc: function (e) { var t = 0; if (e.length == 0) return t; for (i = 0; i < e.length; i++) { char = e.charCodeAt(i); t = (t << 5) - t + char; t = t & t } return t } }; var a = this; var f = e(this); var l = e("body"); var c = f.contents().find("body"); r = u.crc(c.html()); if (!f.is("iframe")) { return } var h = { ifrm: a, $ifrm: f, $docBody: l, $ifrmBody: c }; a.contentWindow.addEventListener("scroll", function () { u.reset(h) }, false); e(a.contentWindow.document).mouseup(function (t) { if (r != u.crc(c.html())) { u.reset(h) } else { var n = t.x ? t.x : t.clientX; var i = t.y ? t.y : t.clientY; var s = a.contentWindow.document.elementFromPoint(n, i); if (s) { if (!e(s).is("td")) { u.reset(h) } } else { u.reset(h) } } }); e(document).keyup(function (e) { if (e.keyCode == 27) { u.reset(h) } }); if (!a.crcChecker) { a.crcChecker = setInterval(function () { var t = u.crc(c.html()); if (r != t) { e(document).trigger("webkitresize-crcchanged", [t, a]) } }, 1e3) } e(window).resize(function () { u.reset(h) }); e(document).bind("webkitresize-crcchanged", function (e, t, n) { if (a != n) return; r = t; u.reset(h) }); e(document).bind("webkitresize-updatecrc", function (e, t, n) { if (a != n) return; r = t }); e(document).bind("webkitresize-table-resized", function (e) { if (a != e) return; u.reset(h) }); u.refresh(h) }) } })(jQuery);